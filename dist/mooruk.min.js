/**
* This Source Code is licensed under the MIT license. If a copy of the
* MIT-license was not distributed with this file, You can obtain one at:
* http://opensource.org/licenses/mit-license.html.
*
* @author: Hein Rutjes (IjzerenHein)
* @license MIT
* @copyright Gloey Apps, 2015
*
* @library mooruk
* @version 0.0.1
* @generated 02-07-2015
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Mooruk=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.variable=b,this.coefficient=c||1}return e(a,[{key:"value",get:function(){return this.coefficient*this.variable.value}}]),a}(),g=function(){function a(b,c){d(this,a),this.constant=b||0,this.terms=c?c:[]}return e(a,[{key:"add",value:function(a){return this.constant+=a.constant,this.terms.push.apply(this.terms,a.terms),this}},{key:"multiply",value:function(a){this.constant*=a;for(var b=0,c=this.terms.length;c>b;b++)this.terms[b].coefficient*=a;return this}},{key:"value",get:function(){for(var a=this.constant,b=0;b<this.terms.length;b++)a+=this.terms[b].value;return a}}],[{key:"fromVariable",value:function(b){return new a(0,[new f(b)])}},{key:"fromConstant",value:function(b){return new a(b)}}]),a}();c.Term=f,c.Expression=g},{}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a){return 0>a?1e-8>-a:1e-8>a}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(){function a(b,c){if(d(this,a),this.cells={},this.constant=b||0,c){this.constant=c.constant;for(var e in c.cells)this.cells[e]=c.cells[e]}}return f(a,[{key:"add",value:function(a){return this.constant+=a,this.constant}},{key:"insertSymbol",value:function(a,b){b=b||1,e(this.cells[a]=(this.cells[a]||0)+b)&&delete this.cells[a]}},{key:"insertRow",value:function(a,b){b=b||1,this.constant+=a.constant*b;for(var c in a.cells){var d=this.cells[c]||0;e(this.cells[c]=d+a.cells[c]*b)&&delete this.cells[c]}}},{key:"remove",value:function(a){delete this.cells[a]}},{key:"reverseSign",value:function(){this.constant=-this.constant;for(var a in this.cells)this.cells[a]=-this.cells[a]}},{key:"solveFor",value:function(a,b){b&&(this.insertSymbol(a,-1),a=b);var c=-1/this.cells[a];delete this.cells[a],this.constant*=c;for(var d in this.cells)this.cells[d]*=c}},{key:"coefficientFor",value:function(a){return this.cells[a]||0}},{key:"substitute",value:function(a,b){var c=this.cells[a];void 0!==c&&(delete this.cells[a],this.insertRow(b,c))}},{key:"empty",get:function(){for(var a in this.cells)return!1;return!0}}]),a}();c["default"]=g,b.exports=c["default"]},{}],3:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b,c){return c+1e3*b+1e6*a}function g(a){return 0>a?1e-8>-a:1e-8>a}function h(a){for(var b in a)this[b]=a[b]}Object.defineProperty(c,"__esModule",{value:!0});var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a("./Row.es6"),k=d(j),l=a("./Expression.es6"),m={SLACK:"S",ERROR:"R",DUMMY:"D",EXTERNAL:"E",CONSTRAINT:"C"},n={LEQ:1,EQU:0,GEQ:-1},o={create:f,REQUIRED:f(1e3,1e3,1e3),STRONG:f(1,0,0),MEDIUM:f(0,1,0),WEAK:f(0,0,1)},p=function(){function a(){e(this,a),this._nextId=1,this._constraints={},this._rows={},this._vars={},this._edits={},this._infeasibleRows=[],this._objective=new k["default"]}return i(a,[{key:"createVariable",value:function(a){return{value:a||0,symbol:this._createSymbol(m.EXTERNAL)}}},{key:"createConstraint",value:function(a,b,c,d){if(b)throw new h({name:"InternalSolverError",message:"Not yet implemented"});return this._createConstraint(a.add(c.multiply(-1)),b,d)}},{key:"addConstraint",value:function(a){if(this._constraints[a.symbol])throw new h({name:"DuplicateConstraintError",message:"The constraint has not been added to the solver.",constraint:a});var b={constraint:a},c=this._createRow(a,b),d=void 0;for(var e in c.cells)if(e.charAt(0)===m.EXTERNAL){d=e;break}if(d||((b.marker.charAt(0)===m.SLACK||b.marker.charAt(0)===m.ERROR)&&c.coefficientFor(b.marker)<0?d=b.marker:(b.other.charAt(0)===m.SLACK||b.other.charAt(0)===m.ERROR)&&c.coefficientFor(b.other)<0&&(d=b.other)),!d){var f=!0;for(var e in c.cells)if(e.charAt(0)!==m.DUMMY){f=!1;break}if(f){if(!g(c.constant))throw new h({name:"UnsatisfiableConstraintError",message:"The constraint can not be satisfied.",constraint:a});d=b.marker}}if(d)c.solveFor(d),this._substitute(d,c),this._rows[d]=c;else if(!this._addWithArtificialVariable(c))throw new h({name:"UnsatisfiableConstraintError",message:"The constraint can not be satisfied.",constraint:a});return this._constraints[a.symbol]=b,this._optimize(this._objective),this}},{key:"removeConstraint",value:function(a){var b=this._constraints[a.symbol];if(!b)throw new h({name:"UnknownConstraintError",message:"The constraint has not been added to the solver.",constraint:a});delete this._constraints[a.symbol],b.marker.charAt(0)===m.ERROR&&this._removeMarkerEffects(b.marker,a.strength),b.other.charAt(0)===m.ERROR&&this._removeMarkerEffects(b.other,a.strength);var c=this._rows[b.marker];if(c)delete this._rows[b.marker];else{var d=this._getMarkerLeavingRow(b.marker);if(!d)throw new h({name:"InternalSolverError",message:"Failed to find leaving row"});c=this._rows[d],delete this._rows[d],c.solveFor(d,b.marker),this._substitute(b.marker,c)}return this._optimize(this._objective),this}},{key:"hasConstraint",value:function(a){return void 0!==this._constraints[a.symbol]}},{key:"addEditVariable",value:function(a,b){if(b=b||o.STRONG,this._edits[a.symbol])throw new h({name:"DuplicateEditVariableError",message:"The edit variable has already been added to the solver.",variable:a});if(b===o.REQUIRED)throw new h({name:"BadRequiredStrengthError",message:"A required strength cannot be used in this context."});var c={constraint:this._createConstraint(new l.Expression(0,[new l.Term(a)]),0,b),constant:0};return this.addConstraint(c.constraint),c.tag=this._constraints[c.constraint.symbol],this._edits[a.symbol]=c,this}},{key:"removeEditVariable",value:function(a){var b=this._edits[a.symbol];if(!b)throw new h({name:"UnknownEditVariableError",message:"The edit variable has not been added to the solver.",variable:a});return this.removeConstraint(b.constraint),delete this._edits[a.symbol],this}},{key:"hasEditVariable",value:function(a){return void 0!==this._edits[a.symbol]}},{key:"suggestValue",value:function(a,b){var c=this._edits[a.symbol];if(!c)throw new h({name:"UnknownEditVariableError",message:"The edit variable has not been added to the solver.",variable:a});var d=b-c.constant;c.constant=b;var e=this._rows[c.tag.marker];if(e)return e.add(-d)<0&&this._infeasibleRows.push(c.tag.marker),this._dualOptimize(),this;if(e=this._rows[c.tag.other])return e.add(d)<0&&this._infeasibleRows.push(c.tag.other),this._dualOptimize(),this;for(var f in this._rows){e=this._rows[f];var g=e.coefficientFor(c.tag.marker);0!==g&&e.add(d*g)<0&&f.charAt(0)!==m.EXTERNAL&&this._infeasibleRows.push(f)}return this._dualOptimize(),this}},{key:"updateVariables",value:function(){for(var a in this._vars){var b=this._rows[a];this._vars[a].value=b?b.constant:0}return this}},{key:"_createConstraint",value:function(a,b,c){return{expression:a,operator:b,strength:c||o.REQUIRED,symbol:this._createSymbol(m.CONSTRAINT)}}},{key:"_createSymbol",value:function(a){return a+this._nextId++}},{key:"_createRow",value:function(a,b){for(var c=a.expression,d=new k["default"](c.constant),e=0,f=c.terms.length;f>e;e++){var h=c.terms[e];if(!g(h.coefficient)){this._vars[h.variable.symbol]=h.variable;var i=this._rows[h.variable.symbol];i?d.insertRow(i,h.coefficient):d.insertSymbol(h.variable.symbol,h.coefficient)}}return a.operator?(b.marker=this._createSymbol(m.SLACK),d.insertSymbol(b.marker,a.operator),a.strength<o.REQUIRED&&(b.other=this._createSymbol(m.ERROR),d.insertSymbol(b.other,-a.operator),this._objective.insertSymbol(b.other,a.strength))):a.strength<o.REQUIRED?(b.marker=this._createSymbol(m.ERROR),b.other=this._createSymbol(m.ERROR),d.insertSymbol(b.marker,-1),d.insertSymbol(b.other,1),this._objective.insertSymbol(b.marker,a.strength),this._objective.insertSymbol(b.other,a.strength)):(b.marker=this._createSymbol(m.DUMMY),d.insertSymbol(b.marker)),d.constant<0&&d.reverseSign(),d}},{key:"_removeMarkerEffects",value:function(a,b){var c=this._rows[a];c?this._objective.insertRow(c,-b):this._objective.insertSymbol(a,-b)}},{key:"_getDualEnteringSymbol",value:function(a){var b=void 0,c=Number.MAX_VALUE;for(var d in a.cells)if(d.charAt(0)!==m.DUMMY&&a.cells[d]>0){var e=this._objective.coefficientFor(d)/a.cells[d];c>e&&(c=e,b=d)}return b}},{key:"_getMarkerLeavingRow",value:function(a){var b=Number.MAX_VALUE,c=b,d=b,e=void 0,f=void 0,g=void 0;for(var h in this._rows){var i=this._rows[h],j=i.coefficientFor(a);if(j)if(h.charAt(0)===m.EXTERNAL)g=h;else if(0>j){var k=i.constant/j;c>k&&(c=k,e=h)}else{var k=i.constant/j;d>k&&(d=k,f=h)}}return e||f||g}},{key:"_optimize",value:function(a){for(;;){var b=void 0;for(var c in a.cells)if(c.charAt(0)!==m.DUMMY&&a.cells[c]<0){b=c;break}if(!b)return;var d=Number.MAX_VALUE,e=void 0;for(var c in this._rows)if(c.charAt(0)!==m.EXTERNAL){var f=this._rows[c].coefficientFor(b);if(0>f){var g=-this._rows[c].constant/f;d>g&&(d=g,e=c)}}if(!e)throw new h({name:"InternalSolverError",message:"The objective is unbounded."});var i=this._rows[e];delete this._rows[e],i.solveFor(e,b),this._substitute(b,i),this._rows[b]=i}}},{key:"_dualOptimize",value:function(){for(;this._infeasibleRows.length;){var a=this._infeasibleRows.pop(),b=this._rows[a];if(b&&b.constant<0){var c=this._getDualEnteringSymbol(b);if(!c)throw new h({name:"InternalSolverError",message:"Dual optimize failed."});delete this._rows[a],b.solveFor(a,c),this._substitute(c,b),this._rows[c]=b}}}},{key:"_substitute",value:function(a,b){for(var c in this._rows){var d=this._rows[c];d.substitute(a,b),c.charAt(0)!==m.EXTERNAL&&d.constant<0&&this._infeasibleRows.push(c)}this._objective.substitute(a,b),this._artificial&&this._artificial.substitute(a,b)}},{key:"_anyPivotableSymbol",value:function(a){for(var b in a.cells)if(b.charAt(0)===m.SLACK||b.charAt(0)===m.ERROR)return b}},{key:"_addWithArtificialVariable",value:function(a){var b=this._createSymbol(m.SLACK);this._rows[b]=new k["default"](a),this._artificial=new k["default"](a),this._optimize(this._artificial);var c=g(this._artificial.constant);this._artificial=void 0;var d=this._rows[b];if(d){if(delete this._rows[b],d.empty)return c;var e=this._anyPivotableSymbol(d);if(!e)return!1;d.solveFor(b,e),this._substitute(e,d),this._rows[e]=d}for(var f in this._rows)this._rows[f].remove(b);return this._objective.remove(b),c}}]),a}();h.prototype=Object.create(Error.prototype),h.prototype.constructor=h;var q={Solver:p,Expression:l.Expression,Term:l.Term,SolverError:h,Operator:n,Strength:o};c["default"]=q,b.exports=c["default"]},{"./Expression.es6":1,"./Row.es6":2}]},{},[3])(3)});